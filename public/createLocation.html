<!DOCTYPE html>
<html>
<head>
    <title>Admin- Create location</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
   <style>
        @font-face {
    font-family: "Dongle-light";
    src: url("Dongle/Dongle-Light.ttf");
}
@font-face {
    font-family: "Dongle-regular";
    src: url("Dongle/Dongle-Regular.ttf");
}
@font-face {
    font-family: "Dongle-bold";
    src: url("Dongle/Dongle-Bold.ttf");
}
.container {
    width: 50%;
    margin: auto;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 10px;
    background-color: #f9f9f9;
}

label {
    display: block;
    margin: 10px 0 5px;
    font-weight: bold;
    font-family: "Dongle-bold";
    font-size: 30px;
}

select, input[type="text"], textarea, input[type="file"] {
    width: 90%;
    padding: 10px;
    margin: 10px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
}

.password-text {
    display: block;
 
    margin: 10px 0;
}

.password-button {
    
    padding: 10px 20px;
    color: white;
    background-color:#ff7f50;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.password-button:hover {
    background-color: orangered;
}

/* Additions for two-row layout */
.form-row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 20px; /* added margin for spacing between rows */
}

.form-group {
    flex: 1;
    min-width: calc(50% - 20px);
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

th, td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
    font-family: "Dongle-regular";
    font-size: 25px;
}

th {
    font-family: "Dongle-bold";
    font-size: 30px;
    background-color: #d8d5d5;
}

tr:hover {
    background-color: #f1f1f1;
}

.edit-button, .delete-button {
    padding: 5px 0px;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top:2px;
    width: 50px;
}

.edit-button {
    background-color:#ff7f50;
}

.edit-button:hover {
    background-color:orangered;
}

.delete-button {
    background-color:#ff7f50;
}

.delete-button:hover {
    background-color: orangered;
}
.place-table{
    padding : 10px 10px 10px 10px;
    margin: 10px 20px 10px 20px;
}
.place-table h2{
    font-family: "Dongle-bold";
    font-size: 43px;
}
.container-div h2{
    font-family: "Dongle-bold";
    font-size: 40px;
}

    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="admin.html"><i class="fa-solid fa-house"></i>&nbsp;&nbsp;Home</a>
        <a href="contacts.html"><i class="fa-solid fa-phone"></i>&nbsp;&nbsp;Contact Us</a>
        <a href="enquirys.html"><i class="fa-solid fa-circle-question"></i>&nbsp;&nbsp;Enquiry</a>
        <a href="createLocation.html"><i class="fa-sharp fa-solid fa-location-dot"></i>&nbsp;&nbsp;Create Location</a>
        <a href="addplace.html"><i class="fa-solid fa-location-pin"></i>&nbsp;&nbsp;Add Places details</a>
        <a href="change-password.html"><i class="fa-solid fa-key"></i>&nbsp;Change Password</a>
        <a href="login.html"><i class="fa-solid fa-right-from-bracket"></i>&nbsp;&nbsp;Logout</a>
    </div>
    
    <div class="navbar">
        <span class="openbtn" onclick="openNav()">&#9776;</span>
        <h2>Admin Dashboard</h2>
    </div>
    
    <div class="container-div">
        <h2>Create Location</h2>
        <form id="addPlaceForm" class="container" method="POST" enctype="multipart/form-data">
            <div class="form-row">
                <div class="form-group">
                    <label for="name">Name of Location:</label>
                    <input type="text" id="name" name="name" class="password-text">
                </div>
            </div>
            <button type="submit" class="password-button">Save</button>
        </form>
        <div class="place-table">
            <h2>PLACES LIST</h2>
            <table id="placesTable">
                <thead>
                    <tr>
                        <th>Serial No</th>
                        <th>Location</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Places data will be dynamically added here -->
                </tbody>
            </table>
        </div>
    </div>

   

    <script>
           function openNav() {
            document.getElementById("sidebar").style.width = "250px";
        }

        function closeNav() {
            document.getElementById("sidebar").style.width = "0";
        }
        document.getElementById('addPlaceForm').addEventListener('submit', function(event) {
            event.preventDefault();
    
            const name = document.getElementById('name').value;
    
            fetch('http://localhost:3000/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name: name })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLocationToTable(data.location);
                } else {
                    alert('Failed to add location.');
                }
            })
            .catch(error => console.error('Error:', error));
        });
    
        function addLocationToTable(location) {
            const tableBody = document.querySelector('#placesTable tbody');
            const newRow = tableBody.insertRow();
            newRow.setAttribute('data-id', location._id); // Store MongoDB document ID
            newRow.insertCell(0).textContent = tableBody.rows.length + 1;
            newRow.insertCell(1).textContent = location.name;
            const actionCell = newRow.insertCell(2);
            actionCell.innerHTML = `
                <button class="edit-button" onclick="editLocation('${location._id}')">Edit</button>
                <button class="delete-button" onclick="deleteLocation('${location._id}')">Delete</button>
            `;
        }
    
        function editLocation(id) {
            const newName = prompt('Enter new name:');
            if (newName) {
                fetch(`http://localhost:3000/edit/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: newName })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Update the table row on success
                        const row = document.querySelector(`#placesTable tbody tr[data-id="${id}"]`);
                        if (row) {
                            row.cells[1].textContent = newName;
                        }
                    } else {
                        alert('Failed to update location.');
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        }
    
        function deleteLocation(id) {
            if (confirm('Are you sure you want to delete this location?')) {
                fetch(`http://localhost:3000/delete/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Remove the table row on success
                        const row = document.querySelector(`#placesTable tbody tr[data-id="${id}"]`);
                        if (row) {
                            row.remove();
                        }
                    } else {
                        alert('Failed to delete location.');
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        }
    
        window.onload = function() {
            
            fetch('http://localhost:3000/locations')
            .then(response => response.json())
            .then(data => {
                data.forEach(location => addLocationToTable(location));
            })
            .catch(error => console.error(error));
            closeNav();
        };
    </script>
        <script src="https://kit.fontawesome.com/6558443b63.js" crossorigin="anonymous"></script>
</body>
</html>